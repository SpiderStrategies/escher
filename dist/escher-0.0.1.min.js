/*!
 * escher.js v0.0.1 
 * Copyright 2012, Spider Strategies <nathan.bowser@spiderstrategies.com> 
 * escher.js may be freely distributed under the BSD license. 
*/
(function(e,t){typeof define=="function"&&define.amd?define(["backbone"],t):t(e.Backbone)})(this,function(e){"use strict";var t=function(e){if(!e.base)throw new Error("Escher must receive the base view");_.defaults(e,{topOffset:15,leftOffset:5,labelField:"name"}),this.opts=e,this.steps=[],this._step(e.base)};t.prototype._step=function(e){var t=new n(e,this.opts);t.index=this.steps.push(t)-1,t.retreat.on("close",function(){var e=this;_.each(_.rest(this.steps,_.indexOf(this.steps,t)+1),function(t){e.pop()})},this)},t.prototype.top=function(){return _.last(this.steps)},t.prototype.bottom=function(){return _.first(this.steps)},t.prototype.push=function(e,t){var n=_.last(this.steps).drop(),r=n.view.$el.offset();e.render().$el.css({"margin-top":r.top+this.opts.topOffset,"margin-left":r.left+this.opts.leftOffset,width:n.view.$el.width()-this.opts.leftOffset,height:n.view.$el.height()-this.opts.topOffset,position:"absolute"}),n.view.$el.after(e.el),this._step(e)},t.prototype.pop=function(){this.steps.length>1&&(this.steps.pop().destroy(),_.last(this.steps).rise())},t.prototype.length=function(){return this.steps.length};var n=function(e,t){this.view=e,this.opts=t,this.retreat=(new r({step:this,label:e[t.labelField]})).render()};n.prototype.drop=function(){return this.view.undelegateEvents(),this.retreat.$el.show(),this.view.$el.append(this.retreat.$el),this},n.prototype.destroy=function(){this.view.undelegateEvents(),this.view.remove(),this.retreat.off("close"),this.retreat.remove(),this.retreat=null},n.prototype.rise=function(){this.view.delegateEvents(),this.retreat.$el.hide()};var r=e.View.extend({className:"escher-step-retreat",attributes:{style:"position: absolute; top: 0; left: 0;"},events:{"click a":"close"},initialize:function(e){this.step=e.step,this.label=e.label},close:function(e){this.trigger("close")},render:function(){return this.$el.html('<a href="#">'+this.label+"</a>"),this}});return e.Escher=t,e});